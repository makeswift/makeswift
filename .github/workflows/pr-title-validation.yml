name: PR Title Validation
on:
  pull_request:
    types: [opened, edited, reopened, synchronize]
jobs:
  validate:
    name: Validate PR Title
    runs-on: ubuntu-latest
    steps:
      - name: Validate Conventional Commits Format
        uses: actions/github-script@v7
        with:
          script: |
            const title = context.payload.pull_request.title;

            // Format: <type>[<linear ticket number(s)>]: <description> or <type>: <description>
            // Examples: feat[ABC-123]: add new feature, fix[TEAM-456, DEV-789]: resolve bug, chore: update deps
            const conventionalCommitRegex = /^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\[[A-Z]+-\d+(,\s*[A-Z]+-\d+)*\])?: .+$/;

            if (!conventionalCommitRegex.test(title)) {
              core.setFailed(
                `PR title "${title}" does not follow the conventional commits format.\n\n` +
                `Expected format: <type>[<ticket(s)>]: <description> or <type>: <description>\n` +
                `Examples:\n` +
                `  feat[ABC-123]: add new feature\n` +
                `  fix[TEAM-456, DEV-789]: resolve multiple issues\n` +
                `  chore: update dependencies\n\n` +
                `Valid types: feat, fix, docs, style, refactor, test, chore, perf, ci, build, revert`
              );
            } else {
              core.info(`PR title "${title}" follows the conventional commits format.`);
            }
