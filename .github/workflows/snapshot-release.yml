name: Snapshot Release

on:
  pull_request:
    types: [opened, synchronize]

concurrency: ${{ github.workflow}}-${{ github.ref }}

jobs:
  snapshot_release:
    name: Snapshot Release
    runs-on: ubuntu-latest
    if: github.event.pull_request.title != 'Version and publish packages'
    steps:
      - name: Check out git repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Setup Git User
        uses: fregante/setup-git-user@v2
      - name: Set up pnpm
        uses: pnpm/action-setup@v2
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20
          cache: pnpm
      - name: Install dependencies
        run: pnpm install --ignore-scripts --frozen-lockfile

      - name: Build
        run: pnpm run build

      - name: Publish Packages
        run: pnpm dlx pkg-pr-new publish './packages/*'
